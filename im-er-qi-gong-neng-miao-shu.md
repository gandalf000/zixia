# im二期功能描述

## 好友关系管理\(暂不支持多端同步\)

### 添加黑名单

功能描述

1. A发送添加B到黑名单的请求
2. 服务器将B加入到A的黑名单，回复A请求成功
3. 后续B给A发送单聊消息，将返回出错，A不会收到

### 移除黑名单

功能描述

1. A发送将B移除黑名单的请求
2. 服务器将B移出A的黑名单，回复A请求成功
3. 后续A可以正常收到B发送的单聊消息

### 获取黑名单

功能描述

1. A发送获取自己的黑名单的请求
2. 服务器查出A的黑名单中所有用户的uid，将其列表返回给A
3. A收到自己的黑名单中的用户列表

## 群组管理功能\(支持多端同步\)

### 创建群组

功能描述

1. 用户发送创建群请求；
2. 服务器收到请求，参数检验合法，创建群组，返回群ID给用户；
3. 用户收到创建的群的ID；

备注

1. 建群参数包括，群名称，群简介，群类型，群权限标志;
2. 名称、简介长度不超过191字节;
3. 权限可选 kOnlyAdminCanInvite //仅创建者可以发起邀请\(或者拉人\)  kDisallowJoinApply //不允许任何人申请加入群 kNeedVerifyJoinApply //申请加入群需要向创建者申请 kOnlyAdminCanSendMsg //仅创建者可以发消息

### 邀请加群，同意/拒绝邀请

功能描述 \* 

群未设置 kOnlyAdminCanInvite 标志的情况

1. A发送邀请B C 加群的请求
2. 服务端处理请求，回复A执行成功
3. 服务端推送 A 邀请 B的消息通知给B， 推送A邀请C的通知给C
4. B C 收到A的邀请
5. 同意的情况下， B  C 回复同意请求给服务器
6. 服务器将 B C 加入群组，回复B C 执行成功
7. 服务器通知所有群成员有新人被邀请进入群组
8. 拒绝的情况下，B C 回复拒绝请求给服务器
9. 服务器处理请求，回复成功给 B C
10. A收到B C的拒绝邀请通知

群设置 kOnlyAdminCanInvite 的情况，上述描述中的 成员A必须为群主才能执行邀请操作

备注：

1. 群人数限制默认为500，任何导致群超员的操作，都会直接返回出错

### 申请加群，同意/拒绝申请

功能描述

群设置 kNeedVerifyJoinApply 标志的情况

1. A发送申请加群的请求
2. 服务器处理请求，回复A成功
3. 服务器推送加群申请通知给群主
4. 群主收到通知，回复同意/拒绝请求给服务器
5. 服务器收到群主的同意/拒绝请求，回复群主成功
6. 同意的情况， A将直接进群，服务器推送同意通知给A 推送新人进群通知给群内其他成员
7. A收到申请被同意通知， 群内其他成员收到新人进群通知
8. 拒绝的情况， 服务器推送拒绝通知给A
9. A收到拒绝通知

 群设置了 kDisallowJoinApply 的情况，任何申请加群 同意 拒绝申请的操作，都会返回错误

当群未设置上述两个标志时, 加群流程如下

1. A发送申请加群的请求
2. 服务器直接将A加入群组，回复A成功，推送加群成功通知给A，推送新人加群通知给群组内其他用户
3. A收到加群成功通知，群组内其他用户收到新人加群通知

备注

1. 群人数限制默认为500，任何导致群超员的操作，都会直接返回出错
2. 申请 和 拒绝申请 可携带附加信息， 最大长度512字节

### 拉人进群

功能描述 \* 群未设置 kOnlyAdminCanInvite 标志的情况

1. 群成员A发送拉 B C 进群的请求
2. 服务器直接把B C加入群组，回复成功给A，推送新人进群通知给群内所有成员，包括B C
3. 群内所有成员收到新人进群通知

群设置 kOnlyAdminCanInvite 标志的情况，上述描述中A必须为群主才能执行拉人操作

备注

1. 群人数限制默认为500，任何导致群超员的操作，都会直接返回出错

### 踢人

功能描述

1. 群主A 发送踢出群成员B C 的请求
2. 服务器收到请求，将 B C 移出群组，回复成功给A，推送群成员被踢通知给剩余全体成员，推送被踢通知给 B C
3. B C 收到被踢通知，剩余群成员收到群成员被踢出通知

### 退群

功能描述

1. 群成员A发送退群请求
2. 服务器将A移出群组，推送成员退出通知到全体群成员
3. 全体群成员（不包括A）收到群成员退出通知

### 解散群

功能描述

1. 群主A发送解散群G请求
2. 服务器清群G信息，回复A解散成功， 推送群解散消息到原群内所有成员
3. 全体群成员收到群解散通知

### 修改群名称

功能描述

1. 群主发送修改群名称请求，新名称长度不超过191字节
2. 服务器修改群名称，回复群主请求成功，推送群名称更新通知到全体群成员
3. 全体群成员收到群名称更新通知

当群组有设置 kMemberCanChangeGroupName 标志位时， 群普通成员也可以修改群名称

### 修改群简介

功能描述

1. 群主发送修改群简介请求，新名称长度不超过191字节
2. 服务器修改群简介，回复群主请求成功，推送群简介更新通知到全体群成员
3. 全体群成员收到群简介更新通知

### 设置/删除群名片

功能描述

1. 群成员A发送设置/删除群名片请求
2. 服务端处理请求，回复A请求成功，推送群名片更新/删除通知给全体群成员
3. 全体群成员收到群A的群名片更新/删除通知

备注

1. 群名片大小不超过 191个字节

### 获取群列表

功能描述

1. A用户发送获取群列表请求
2. 服务器收到请求，查出所有包含A的群，这些群的AD的列表
3. 用户收到自己的群ID列表

### 获取群成员列表

功能描述

1. 群G成员发A送获取群G成员列表的请求
2. 服务器查出G中所有成员，返回成员uid的列表给A
3. A收到群G全体群成员的uid列表

### 获取群信息

功能描述

1. 群G成员发A送获取群G群信息的请求
2. 服务器查出G的群组信息，返回给A
3. A收到群G的群组信息

### 获取群名片（单次/批量）

功能描述

单次

1. 群G成员A发送获取G中成员B的名片的请求
2. 服务器查出B的名片，返回给A
3. A获取到B的群名片

批量

1. 群G成员A发送批量获取群G的群名片的请求
2. 服务器查出群G中所有成员的群名片，返回给A
3. A获取到群G所有成员的群名片

## 群聊

功能描述

只支持文本消息

群组未设置 kOnlyAdminCanSendMsg 标志的情况

1. 群成员A发消息到到群G
2. A收到服务器返回成功
3. 群内所有成员的各个端都能收到消息

群组设置 kOnlyAdminCanSendMsg 标志的情况，只有群主才能发送消息，其他同上







